var GlobalHeader=require("./global-header.js"),chill=require("./chill.js"),oops=require("./oops.js").create({defaultCallback:"alert",register:require("./error-index.js")}),clickCount=0;$(".notifications-tab").on("click",function(e){clickCount===5?(chill.lightningBolt(),clickCount=0):clickCount++}),setInterval(function(){clickCount=0},2e3),$.emojiarea.path=DIY.globals.emojis.path,$.emojiarea.icons=DIY.globals.emojis.icons,DIY.intercom=Intercom.getInstance(),DIY.notifications=new NotificationService($("#notifications")),function(){var e=null;DIY.session.maker&&(e="maker::"+DIY.session.maker.id),DIY.session.parent&&(e="parent::"+DIY.session.parent.id);var t=new GlobalHeader($(".global-header"));e||$(function(){DIY.notifications.sticky("wcta",{subject:null,action:"broadcast",text:"Welcome to DIY! Share what you make and be awesome!",text_html:"<strong>Welcome to DIY!</strong> Share what you make and be awesome!",text_caption:null,text_caption_html:'<a href="itms://itunes.apple.com/us/app/diy-get-skills.-become-awesome./id519308960?mt=8&amp;uo=4" target="itunes_store"><strong>Download the App</strong></a> or <a href="/#join"><strong>Join</strong></a>.'})});var n=DIY.createComponent("notification-badge",{notifications:DIY.notifications});n.addClass("badge notifications-badge-count");var r=$(".notifications-badge");n.on("count-updated",function(e,t,i,s){i===0?(n.detach(),r.removeClass("notifications-badge-active")):(r.append(n),r.addClass("notifications-badge-active"));if(t===0){$(".notifications-panel").addClass("notifications-panel-empty"),$(".notifications-empty-message").show();var o=$(".notifications-panel .notifications-header");o.text(o.attr("data-finished-text"))}else $(".notifications-panel").removeClass("notifications-panel-empty"),$(".notifications-empty-message").hide()}),$(document).on("dismissNotification",function(e,t){DIY.notifications.dismiss(t)}),$(document).on("notificationRead",function(e,t){DIY.notifications.read(t)}),DIY.intercom.on("dismiss",function(e){DIY.notifications.dismiss(e.id)}),DIY.intercom.on("notice",function(e){DIY.notifications.add("socket",e),$(".global-header").trigger("notification",[e])});if(!e||!DIY.socket)return;DIY.socket.emit("register",e),DIY.intercom.bind(DIY.socket,{id:function(e,t){if(typeof t=="object"&&t.id)return e+t.id},send:function(e,t){return t.socket!==!1}})}(),$(function(){var e=$("body");e.on("click","a.signin, button.signin, .anonymous.signin",function(e){return DIY.signin({reason:$(this).attr("data-reason")}),!1}),e.on("click","a.require-session",function(e){var t,n;if(!DIY.session.maker)return t=$(this).attr("href"),n=/^(#|javascript\:)/.test(t)?window.location.href:t,DIY.signin({reason:$(this).attr("data-reason"),destination:n}),e.stopPropagation(),!1}),e.on("click",".resend-verification",function(){var e=$(this);if(e.hasClass("disabled"))return;e.removeClass("disabled"),$.ajax({url:"/ajax/resend",type:"POST",dataType:"json",success:function(t){t.status==="success"?e.replaceWith("<strong>Sent!</strong>"):(e.removeClass("disabled"),alert(t.message))},error:function(){e.removeClass("disabled"),alert("There was an error when trying to resend the email. Check your internet connection and try again.")}})}),e.on("click",".btn.follow",function(e){if(!DIY.session.maker)return DIY.signin({reason:"You must sign in to follow this maker."}),!1;var t=$(this),n=t.attr("data-id"),r=t.attr("data-url"),i=!!parseInt(t.attr("data-following"),10),s=i?"unfollow":"follow";return t.hasClass("disabled")?!1:(t.addClass("disabled"),$.ajax({url:"/ajax/"+s,type:"POST",data:{maker:r},success:function(e){_mxp("social",s),t.html(i?"Follow":"Unfollow"),t.attr({"data-following":i?"0":"1"}),t.trigger("reposition")},error:function(){alert("Please check your internet connection and try again")},complete:function(){t.removeClass("disabled")}}),!1)}),$.hovertips(".hover-stats",function(){var e={};return DIY.session.maker&&(e.ajax=function(e){return{url:"/ajax/stats",dataType:"json",data:{source:DIY.session.maker.id,target:e.attr("data-id")}}}),$.extend({delay_hide:500,delay_hover:100,delay_leave:50,filter:function(e){var t=parseInt(e.attr("data-id"),10);return!DIY.session.maker||t!==DIY.session.maker.id},render:function(e,t,n){var r,i=t&&t.following;return n?(r=$("<div>"),r.addClass("btn-tooltip-loading"),(new Spinner({lines:9,length:2,width:2,radius:4,corners:1,rotate:0,color:"#606060",speed:1,trail:49,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:5,left:6})).spin(r[0])):(r=$('<a href="javascript:void(0)">'),r.addClass("follow btn btn-primary btn-tooltip"),r.html(i?"Unfollow":"Follow"),r.attr({"data-following":i?"1":"0","data-id":e.attr("data-id"),"data-url":e.attr("data-url")})),r}},e)}()),$.hovertips(".nav-tabs a",{delay_hide:300,delay_hover:100,delay_leave:0,filter:function(e){var t=e.parent();return!t.hasClass("active")&&!t.parent().hasClass("nav-buttons")},render:function(e,t,n){var r,i=this;return r=$("<div>"),r.addClass("nav-tabs-tooltip"),r.html(e.html()),e.on("click",function(){i.hide(0)}),r}}),$.hovertips(".hovertip",{delay_hide:300,delay_hover:100,delay_leave:0,render:function(e,t,n){var r=e.data("tooltip");return r?$("<div>").html(r).addClass(e.data("tooltip-skin")+"-tooltip nav-tabs-tooltip"):!1}}),$("body").on("click",function(e){$(".btn-popover").each(function(){!$(this).is(e.target)&&$(this).has(e.target).length===0&&$(".popover").has(e.target).length===0&&$(this).popover("hide")})}),$("body").on("click",".section-tabs .tab-item a, .fat-tabs .tab-item a",function(e){var t=$(e.currentTarget);t.parents(".section-tabs, .fat-tabs").find(".tab-item").removeClass("active tab-item-active"),t.parent().addClass("active tab-item-active")})});var avatarPicker=require("./avatar-picker.js");DIY.defineSection("/:makerurl/account/identity",function(e,t){var n=e,r=$(".species-selector a",n),i=$("input[name=species]",n),s=$("input[name=nickname]",n);e.on("section-beforeunload",function(){if(n.hasClass("changed"))return"Hold up! Are you sure you want to lose your changes?"});var o=function(e,t,n){return{x:n%t,y:Math.floor(n/t),i:n}},u=5,a=11,f=u*a,l=$(".avatars"),c=$("#avatar-list"),h=$("input[name=avatar]");$.ajax({url:"/api/avatars",data:{limit:f},dataType:"json",success:function(e){var n=e.response.concat(t["pioneer-avatars"]),r=n.length;for(var i=0;i<n.length;i++)n[i].position=o(u,a,i);avatarPicker("#avatar-list",n),$(".avatar-item[data-id="+h.val()+"]").addClass("picked-avatar")}}),$(document).on("avatarPicked",function(e,t,n){h.val(t.id)}),n.modelValidate(DIY.globals.models.maker,{wait:!1,events:"blur keyup"}),n.ajaxForm({url:"/ajax/update/maker",success:function(e){$(".user-controls .avatar img").attr("src",e.maker.avatar.small.url),e.maker.url!==DIY.session.maker.url&&(window.location.href="/"+e.maker.url+"/account")}})}),DIY.defineSection("/:makerurl/account/password",function(e,t){var n=e,r=$("input[name=password]",n),i=$("input[name=password-again]",n),s=$("input[name=password-current]",n);n.modelValidate(DIY.globals.models.maker,{wait:!0,events:"blur",constraints:{"current-password":function(){this.watchField(s);if(!s.val().length)return this.updateField(s,!1,"What's your current password?"),!1;this.updateField(s,!0)},"passwords-eq":function(){if(!r.hasClass("error")){this.watchField(r),this.watchField(i);if(r.val()!==i.val())return this.updateField(r,!1,"Your passwords don't match!"),this.updateField(i,!1),!1;this.updateField(r,!0),this.updateField(i,!0)}}}}),n.ajaxForm({url:"/ajax/update/maker"})}),DIY.defineSection("/blog",function(e,t){Chunklet.find("list").on("load",function(e){var t=0,n=Math.max($("html").scrollTop(),$("body").scrollTop());n-t>220&&window.setTimeout(function(){$("html, body").animate({scrollTop:t},300,"easeOutExpo")},100)})}),DIY.defineSection("/add/project:challenge",function(e,t){var n=$("#form-upload"),r=$("#form-pick-project"),i=$(".save .btn"),s=null,o=$(".project-selector",r),u=!1,a=function(){if(u)return!1;u=!0;var e=DIY.initComponent("project-selector",o,{maker:DIY.session.maker.url,onChange:function(e){s=e,i.removeClass("disabled")}})};$("#pick-method a").on("click",function(){var e=$(this).hasClass("upload");return $(".upload-project").toggle(e),$(".pick-project").toggle(!e),$("#pick-method").hide(),e||a(),!1}),$("#toggle-upload-project").on("click",function(){$(".upload-project").show(),$(".pick-project").hide()}),$("#toggle-pick-project").on("click",function(){$(".upload-project").hide(),$(".pick-project").show(),a()}),e.on("projectCreated",function(e,t){s=t.id}),i.on("click",function(e){return e.preventDefault(),typeof s=="undefined"?(alert("Oops! Please select a project first!"),!1):(i.addClass("disabled"),$.ajax({url:"/ajax/update/project",data:n.serialize(),type:"POST",cache:!1,dataType:"json",success:function(e){$.ajax({type:"POST",url:"/ajax/add/achievement",data:{project:s,skill:t.skill.id,challenge:t.challenge.id},dataType:"json",success:function(e){if(e.status==="success"){_mxp("achievements","submit_achievement");var n="/skills/"+t.skill.url;e.notification&&(n+="?n="+e.notification),window.location.href=n}else oops(e.message||"Oops! An error occurred."),i.removeClass("disabled")},error:function(){alert("Please check your internet connection and try again."),i.removeClass("disabled")}})},error:function(){readOnly=!1,updateView()}}),!1)})}),DIY.defineSection("/explore",function(e,t){function n(){var e=this.$el.offset().top-75,t=Math.max($("html").scrollTop(),$("body").scrollTop());t-e>220&&window.setTimeout(function(){$("html, body").animate({scrollTop:e},300,"easeOutExpo")},100)}Chunklet.on("load","everyone.projects",n),Chunklet.on("load","projects",n)}),DIY.defineSection("/:maker",function(e,t){var n=$(window),r=$("body");DIY.initComponent("design-panel",$("#design-panel"));var i=function(e){var t=this.$el.offset().top-95,n=Math.max($("html").scrollTop(),$("body").scrollTop());n-t>220&&window.setTimeout(function(){$("html, body").animate({scrollTop:t},300,"easeOutExpo")},100)};Chunklet.find("favorites").on("load",i),Chunklet.find("projects").on("load",i),function(){var t=$(".bio.editable",e),n=function(e){e&&e.stopPropagation();var n=27,r=!!parseInt($(this).attr("data-empty")),i=r?"":t.text(),s=$("body"),o=$("<textarea>").addClass("bio").text(i);o.attr({maxlength:60}),t.hide(),t[0].hovertip&&t[0].hovertip.hide(0),t.after(o),o.show().select();var u=function(){t.show(),o.remove(),s.off("click",f)},a=function(){u()},f=function(e){o.attr({readonly:"readonly"});var n=$.trim(o.val());if(n===i){u();return}$.ajax({url:"/ajax/update/maker",type:"POST",dataType:"json",data:{bio:n},success:function(e){e.status==="success"&&(_mxp("portfolio","edit_bio"),t.attr("data-empty",n.length?"0":"1"),t.text(n),u())},complete:function(){o.removeAttr("readonly")}})};o.on("click",function(e){e.stopPropagation()}),o.on("keydown",function(e){e.keyCode===n&&a()}),s.on("click",f)};$.hovertips(t,{delay_leave:0,delay_hover:0,render:function(){var e=$('<a href="javascript:void(0)">');return e.addClass("edit btn btn-primary btn-tooltip"),e.html("Edit"),e.on("click",n),e}}),t.on("click",n)}()}),DIY.defineSection("notifications",function(e,t){if(t&&t.length)for(var n=0;n<t.length;n++)DIY.notifications.add("web",t[n])}),function(){var e=function(e,t){var n=$(".nav a",e),r=$(".content section",e).hide(),i=!1;n.on("click",function(){n.parent().removeClass("active"),$(this).parent().addClass("active"),r.hide();var e=$(this).attr("href").match(/(#.+)$/)[1];return i&&(window.location.hash=e),$(e).show(),!1});var s=window.location.hash||null,o=s?n.filter("[href="+s+"]"):[];o.length||(o=$(n[0])),o.trigger("click"),i=!0,window.setTimeout(function(){$(window).scrollTop(0)},0)};DIY.defineSection("/about",e),DIY.defineSection("/policies",e)}(),DIY.defineSection("/add/project",function(e,t){function W(r){$.ajax({url:"/ajax/add/project",data:_.extend({remake:t.remakeId},n.serialize()),type:"POST",cache:!1,dataType:"json",success:function(n){n.status==="success"?(t.action="edit",S=n.project,$("#project-input").val(n.project.id),e.trigger("projectCreated",[n.project]),typeof r=="function"&&r(n)):(oops(n.message),T=!1,I())},error:function(){T=!1,I()}})}var n=$("#form-upload"),r=$(window),i=$("input[name=title]",n),s=$("label[for=title]",n),o=$(".title .step",n),u=$("<span>").addClass("error").hide().insertAfter(i),a=$("input[name=cover]",n),f=$(".pick-file",n),l=$(".file-button a",n),c=$("input[name=media]",n),h=$(".drag-area",n),p=$(".add-photo",n),d=$(".overlay",p),v=$(".img",d).hide(),m=$(".bar",d),g=$(".step label",p),y=$(".no-files",n),b=$(".has-files",n),w=$(".clips",b),E=$(".new",w),S=t.project||null,x=0,T=!1,N=419430400,C=1,k=2,L=3,A="R04Dqc4rfLXeiueY3ef75QX7",O={auth:{key:"ce68c6e920ea4517a311ce07c6cf0e4d"},template_id:null,redirect_url:window.location.href},M=[{type:"image",id:DIY.globals.services.transloadit.templates["clip-image"],formats:["jpg","jpeg","png","cr2","dng","bmp"]},{type:"video",id:DIY.globals.services.transloadit.templates["clip-video"],formats:["mov","mp4","mpg","mpeg","avi","wmv","m4v","m2v"]}];w.css({"float":"left"});var D=function(e){var t="An unknown error occurred.";switch(e){case C:t="One or more of your files could not be added because their format(s) aren't supported.";break;case k:t="Oops! Something went wrong when creating a clip. Please check your internet connection and try again.";break;case L:t="One of the files you added was too big. Nothing bigger than "+Math.round(N/1048576)+"mb, please."}_mxp("error","asset_upload_error",{message:t}),alert(t)},P=function(e){function t(e){if(e.length>10)alert("No more than 10 files at a time, please!");else if(e.length>0){var t=[];for(var n=0;n<e.length;n++)H(e[n],function(e){t.indexOf(e)===-1&&(_.delay(function(){D(e)},20),t.push(e))})}}S?t(e):W(function(n){t(e)})},H=function(e,t){var n=typeof e.tagName!="string"||e.tagName.toLowerCase()!=="input",r=(n?e.name||e.fileName||"":$(e).val()||"").match(/([^\/\\]+)$/)[1],i=r.substring(r.lastIndexOf(".")+1).toLowerCase(),s=null;O.template_id=null;for(var o=0;o<M.length;o++)if(M[o].formats.indexOf(i)!==-1){s=M[o],O.template_id=M[o].id;break}if(!s){t(C);return}if(n&&(e.size||0)>N){t(L);return}x++,I();var u=F().addClass("loading"),f=$(".image",u).attr({title:r});if(n&&typeof FileReader=="function"&&e.size<3145728&&(e.type==="image/png"||e.type==="image/jpeg"||e.type==="image/gif")){var l=new FileReader;l.onload=function(e){var t=f.css("background-image");e.target.result&&(t==="none"||!t)&&(f.css({opacity:0,"background-image":"url("+e.target.result+")"}),window.setTimeout(function(){f.animate({opacity:1},1e3)},100))},l.readAsDataURL(e)}var h=$("<div>").addClass("spinner").css({opacity:0});u.prepend(h),h.animate({opacity:.7},200);var p=_.once(function(){h.stop().animate({opacity:0},200,function(){h.remove()})}),d=$("<div>").addClass("overlay"),v=$("<div>").addClass("progress-bar").appendTo(d),m=$("<div>").addClass("spinner").css({opacity:0}).appendTo(d);return u.prepend(d),d.css({opacity:0}).show().animate({opacity:1},100),v.css({width:0}),I(),j(s.type,function(n){if(!n){x--,u.remove(),I(),t(k);return}var i=a.val()||"";!i.length&&$(".set-cover.active",u).length&&a.val(n),u.attr({"data-id":n}),u.trigger("id");var s=$("<form>").attr({action:"http://api2.transloadit.com/assemblies",method:"POST",enctype:"multipart/form-data"}).css({visibility:"hidden"});s.append('<input type="hidden" name="params" value="'+JSON.stringify(O).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")+'">'),s.append('<input type="hidden" name="encoder_key" value="'+A+'">'),s.append('<input type="hidden" name="clip_id" value="'+n+'">'),s.append('<input type="hidden" name="public_key" value="'+DIY.session.maker.key+'">'),$("body").append(s);var o=_.once(function(e){p(),v.stop().animate({width:"100%"},1e3,"easeInOutCubic",function(){m.stop().animate({opacity:.2},200)}),x--,I()}),l=(new Date).getTime();s.transloadit({wait:!0,modal:!1,debug:!0,autoSubmit:!1,fields:"input[name=clip_id],input[name=encoder_key],input[name=public_key]",onProgress:function(e,t,n){var r=e/t;v.stop().animate({width:(r*100).toString()+"%"},2e3,"easeInOutCubic",function(){r>.99&&(p(),m.stop().animate({opacity:.2},200))})},onError:function(e){u.remove(),DIY.notifications.alert('There was an error uploading "'+r+'". Please try again.'),x--,I()},onUpload:o,onSuccess:function(e){_mxp("projects","upload_shot",{elapsed:(new Date).getTime()-l}),o(null);if(e.results&&e.results.web_220){var t=new Image;t.onload=function(){u.removeClass("loading"),d.stop().animate({opacity:0},500,function(){d.remove()}),f.css({"background-image":"url("+t.src+")"})},t.src=e.results.web_220[0].url.replace(/^https?:\/\//,"//")}}});if(typeof e.tagName=="string"&&e.tagName.toLowerCase()==="input"){var h=$(e).clone(!0);c.after(h),s.append(c)}else s.transloadit("addFile","media",e);s.trigger("submit.transloadit")}),!0},B=function(e,t){S&&$.ajax({url:"/ajax/delete/clip",type:"POST",cache:!1,dataType:"json",data:{id:e,project:S.id}}),t(!1)},j=function(e,t){function n(t){$.ajax({url:"/ajax/add/clip",type:"POST",cache:!1,dataType:"json",data:{type:e,project:S.id},success:function(e){_mxp("project","add_shot"),t(e.status==="success"?e.clip.id:0)},error:function(){t(0)}})}n(t)},F=function(e){typeof e=="undefined"&&(e={});var t=e.id||0,n=$("<li>").addClass("clip");n.on("id",function(){var e=n.attr("data-id")||0;i.val(e),s.attr({name:"clip-changed[id-"+e+"]"}),o.attr({name:"clip-caption[id-"+e+"]"})});var i=$('<input type="hidden" name="clip-id[]">'),s=$('<input type="hidden" value="0">'),o=$('<input type="text">');n.append(i),n.append(s);var u=$('<a href="#">').attr({title:"Delete Clip"}).css({opacity:0}).addClass("action delete").appendTo(n).hide(),a=$("<div>").addClass("image").appendTo(n),f=$("<div>").addClass("caption").appendTo(n);return f.append(o),t&&(n.attr({"data-id":t}),n.trigger("id")),typeof e.caption!="undefined"&&o.val(e.caption),typeof e.assets!="undefined"&&e.assets.hasOwnProperty("web_220")&&a.css({"background-image":"url("+e.assets.web_220.url+")"}),o.attr({placeholder:"Click to add caption"}).placeholder({force:!0}),o.on("change",function(){s.val("1")}),n.on("mouseenter",function(){n.hasClass("loading")||u.show().stop().animate({opacity:1},100)}),n.on("mouseleave",function(){u.stop().animate({opacity:0},100)}),u.on("click",function(){return confirm("Are you sure you want to delete this clip?")&&B(i.val(),function(e){e?alert(e):(n.remove(),I())}),!1}),E.before(n),_.defer(function(){r.trigger("resize")}),n},I=function(){var e=$(".clip",b).children().length>0;q.toggleClass("disabled",!e||x>0||T),c.detach(),e?(y.hide(),b.show(),$(".file-button",b).append(c.show())):(b.hide(),y.show(),$(".file-button",y).append(c.show())),E.toggle(!T),T?i.attr({readonly:"readonly"}):i.removeAttr("readonly"),_.defer(function(){r.trigger("resize")})};h.on("dragenter dragover",function(e){var t=$(this),n=$("p",t),r=$(".file-button a",t);$(".file-button").css("pointer-events","none"),typeof r.data("default-text")=="undefined"&&r.data("default-text",r.html()),typeof n.data("default-text")=="undefined"&&n.data("default-text",n.html()),t.addClass("drag-over"),r.addClass("disabled"),t.parents(".clips").length?(r.html("Drop"),n.html("Let go!")):(r.html("Drop to upload file(s)"),n.html("Now let go!")),e.stopPropagation(),e.preventDefault()}),h.on("dragexit dragleave",function(e){var t=$(this),n=$("p",t),r=$(".file-button a",t);$(".file-button").css("pointer-events","auto"),t.removeClass("drag-over"),r.removeClass("disabled").html(r.data("default-text")),n.html(n.data("default-text")),e.stopPropagation(),e.preventDefault()}),h.on("drop",function(e){var t=e.currentTarget.files||e.originalEvent.dataTransfer.files;t.length>10?alert("No more than 10 files at a time, please!"):t.length>0&&P(t),$(this).trigger("dragleave"),e.stopPropagation(),e.preventDefault()}),c.css({display:"none"}),l.click(function(){c.click()});var q=$(".save a").on("click",function(){if(q.hasClass("disabled"))return!1;q.addClass("disabled"),i.attr({readonly:"readonly"});var e=t.action==="add"?"add":"update";return T=!0,I(),$.ajax({url:"/ajax/"+e+"/project",data:n.serialize(),type:"POST",cache:!1,dataType:"json",success:function(e){e.status==="success"?window.location.href=e.project.href+(e.notification?"?n="+e.notification:""):(oops(e.message),T=!1,I())},error:function(){T=!1,I()}}),!1});i.on("keyup change",function(){var e=$.trim(i.val()),t=validate.model({title:e},DIY.globals.models.project,"title");t.valid?u.hide():u.text(t.errors.title[0].message).show()}),c.on("change",function(){var e=this;typeof this.files!="undefined"?P(this.files):S?H(e,function(e){D(e)}):W(function(t){H(e,function(e){D(e)})})});if(t.action==="edit"){if(S.clips.length)for(var R=0;R<S.clips.length;R++)F(S.clips[R]);S.cover&&$(".clip",w).filter("[data-id="+S.cover+"]").find(".set-cover").trigger("click")}n.on("submit",function(e){return e.preventDefault(),!1});var U=DIY.createComponent("achievements-list",t),z=$(".achievement-badge");z.popover({html:!0,trigger:"click",placement:"bottom",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-content" style="padding: 0;"><div></div></div></div></div>',content:$("<div></div>").append(U).html()}),z.on("click",function(){$(this).popover("toggle")}),I()}),DIY.defineSection("/edit/project",function(e,t){DIY.initSection("/add/project",e,t)}),DIY.defineSection("/:makerurl/:projectid",function(e,t){var n=$(".content.project");DIY.initComponent("design-panel",$("#design-panel"));if(t["can-favorite"]){var r,i,s,o,u,a=$(".project-actions",n),f=$(".btn-favorite",a),l=$(".label",f);f.on("click",function(t){if(!DIY.session.maker)return DIY.signin({reason:"You must be signed in to favorite this project.",destination:window.location.href}),t.stopPropagation(),!1;if(f.hasClass("disabled"))return;return u=$(".count",f),r=n.attr("data-id"),s=parseInt(u.html())||0,i=!!parseInt(n.attr("data-favorited")),i?(o=s-1,DIY.removeFavorite(r),f.removeClass("on"),l.html("Favorite"),u.html(Math.max(0,o)),n.attr("data-favorited",""),e.trigger("project:favorite",[i,o,DIY.session.maker]),_mxp("social","unfavorite")):(o=s+1,DIY.addFavorite(r),f.addClass("on"),l.html("Favorited"),u.html(s+1),n.attr("data-favorited","1"),e.trigger("project:favorite",[i,o,DIY.session.maker]),_mxp("social","favorite")),o<=0?u.addClass("zero-count"):u.removeClass("zero-count"),!1})}var c=$(".favorites-wrapper",e);e.bind("project:favorite",function(e,t,n,r){var i="";n<=0?c.addClass("hide-visually"):c.removeClass("hide-visually"),n===1?i=n+" Favorite":i=n+" Favorites",$(".label",c).text(i);if(t)c.find('[data-maker-id="'+r.url+'"]').remove();else{var s=$("<li></li>").attr("data-maker-id",r.url).addClass("animated pulse").css({transformOrigin:"14px 14px"});s.append(Handlebars.templates["www-maker-small"](r)),c.find(".favorites-list").append(s)}}),$("#content .btn.edit").on("click",function(){return window.top.location.href="/edit/project/"+t.project.id,!1}),$("#content .btn.delete").on("click",function(){var e=$(this);return e.hasClass("disabled")?!1:(confirm("Are you SURE you want to delete this project? This can't be undone!")&&(e.addClass("disabled"),$.ajax({url:"/ajax/delete/project",type:"POST",data:{id:t.project.id},dataType:"json",success:function(t){_mxp("projects","delete"),e.removeClass("disabled"),t.status==="success"?window.top.location.href="/"+DIY.session.maker.url:alert("Error: "+t.message)},error:function(){e.removeClass("disabled"),alert("Oops, something went wrong. Please check your internet and try again.")}})),!1)}),Chunklet.find("stream").on("load",function(){DIY.initComponent("comments",$(".comments",e),$.extend(t,{"current-maker":DIY.session.maker,collapsed:!0}))}),$("body").on("comment-reply",function(e,t,n,r){var i=n.parents(".replies:first");i.length<=0&&(i=n),i.find(".comments-list:first").append(r)}),$("body").on("comment-reply-editor",function(e,t,n,r){$(".replies").find(".comment-editor").remove();var i=n.parents(".replies");i.length===0&&(i=n),i.append(r),$("html, body").animate({scrollTop:r.offset().top-100},300)}),$(document).on("keyup",function(e){var t=e.target||e.srcElement;if(!DIY.session.maker)return;if(e.keyCode!==67)return;if(t.tagName==="INPUT"||t.tagName==="SELECT"||t.tagName==="TEXTAREA"||t.contentEditable&&t.contentEditable==="true")return;return $(".emoji-wysiwyg-editor").focus(),!1});var h=DIY.createComponent("achievements-list",t),p=$(".achievement-badge");p.popover({html:!0,trigger:"click",placement:"bottom",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-content" style="padding: 0;"><div></div></div></div></div>',content:$("<div></div>").append(h).html()}),p.on("click",function(e){$(this).popover("toggle"),e.preventDefault()});var d=DIY.createComponent("social-buttons",t),v=$(".btn-share");v.popover({html:!0,trigger:"click",placement:"bottom",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><div class="social-media"></div></div></div></div>',content:$("<div></div>").append(d).html()}),v.on("click",function(){$(this).popover("toggle")}),$(".btn-remake").on("click",function(e){if(!DIY.session.maker)return DIY.signin({reason:"You must be signed in to fork this project.",destination:$(e.currentTarget).attr("href")}),e.stopPropagation(),!1;e.stopPropagation()}),$(".box-remake").on("click",function(e){$.dialog("dialog-forking")})}),DIY.defineSection("/skills/:id",function(e,t){e.on("click",".references .more a",function(e){var t=$(this).parents(".references:first");return $("li",t).show(),$(this).hide(),!1}),window.location.hash==="#welcome"&&DIY.session&&DIY.session.maker&&(new DIY.Takeover("takeover-welcome",{nickname:DIY.session.maker.nickname,url:DIY.session.maker.url,avatar:DIY.session.maker.avatar.medium.url})).show(),t.relatedSkills.push(t.skill),skillPatchGrid.initGrid(".skill-patch-grid",t.relatedSkills,t.skill.url),e.on("click",".maker-challenges .signin",function(e){return DIY.signin({reason:$(this).attr("data-reason")}),!1}),e.on("click",".challenge-sort-btn",function(t){if($(this).hasClass("active"))return!1;$(".challenge-sort-btn",e).removeClass("active"),$(this).addClass("active");switch($(this).data("sort-by")){case"difficulty":$(".skill-challenges-list > li",e).tsort({attr:"data-difficulty",order:"asc"});break;case"id":$(".skill-challenges-list > li",e).tsort({attr:"data-id",order:"desc"})}return!1})}),DIY.defineSection("/skills",function(e,t){window.location.pathname==="/skills/sort/newest"&&($(".btn",e).removeClass("active"),$(".btn[data-sort=newest]",e).addClass("active"),$("ul.skills li:not(.featured)",e).tsort({attr:"data-id",order:"desc"})),e.on("click",".inner .btn",function(t){if($(this).hasClass("active"))return!1;$(".btn",e).removeClass("active"),$(this).addClass("active");switch($(this).data("sort")){case"alpha":$("ul.skills li:not(.featured)",e).tsort(),window.history.replaceState(null,null,"/skills/sort/title");break;case"newest":$("ul.skills li:not(.featured)",e).tsort({attr:"data-id",order:"desc"}),window.history.replaceState(null,null,"/skills/sort/newest")}return!1})}),DIY.defineSection("/stories",function(e,t){$("#video",e).fitVids(),window.setTimeout(function(){$("#social").addClass("ready")},1e3)}),DIY.defineSection("/following",function(e,t){var n={comment:function(e){_.each(e.items,function(t){DIY.initComponent("comments",$(".comments",$("#"+e.streamId)),{comment:t.comment,project:e.project,"current-maker":DIY.session.maker,loadComments:!1})})}};_.each(t,function(e){n.hasOwnProperty(e.type)&&typeof n[e.type]=="function"&&n[e.type].call(this,e)})}),DIY.defineSection("/stream",function(e,t){var n=$(".stream",e),r,i=0,s=$("body");s.on("comment-reply-editor",function(e,t,n,r){var i=$('<div class="comment comment-editor"></div>');t.after(i.append(r)),r.find(".btn.save").addClass("text-icon"),r.on("cancel",function(){i.remove()}),s.on("comment-reply",function(e,t,n){var r=$('<p class="notice-inline">Your reply has been sent!</p>');i.empty(),i.append(r),setTimeout(function(){i.fadeOut("fast",function(){i.remove()})},3e3)})})}),function(){var e={id:0,name:"Basic"};e.build=function(e,t){var n=t.xcolor;/^\#[0-9a-fA-F]{6,6}$/.test(e.foreground)||(e.foreground="#2b2b2b"),/^\#[0-9a-fA-F]{6,6}$/.test(e.background)||(e.background="#ffffff");var r=n(e.foreground),i=n(e.background),s=r.getHex(),o=i.getHex(),u=n.darken(o,1,10).getHex(),a=n.opacity(s,o,.6).getHex();return{".outer.header":{"background-color":o,color:s},".outer.header h1":{color:s},".outer.header .bio":{color:a},".outer.header li.empty:before":{color:u}}},typeof module!="undefined"&&(module.exports=e),typeof window!="undefined"&&(typeof window.DIY=="undefined"&&(window.DIY={}),typeof window.DIY.themes=="undefined"&&(window.DIY.themes={}),window.DIY.themes[e.id]=e)}()